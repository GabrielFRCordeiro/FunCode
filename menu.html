<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FunCode</title>
    <link rel="icon" href="./assets/favicon.ico">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" 
    rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH"
    crossorigin="anonymous">
    <link rel="stylesheet" href="./css/style.css">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Patrick+Hand+SC&display=swap" rel="stylesheet">
</head>
<body>
  <nav class="navbar navegacao">
    <div class="container-fluid">
        <img src="./assets/robo_nav.png" alt="robo_nav">

        <div class="coluna">    
            <a class="navbar-brand imagem_nav" href="#">
                <img src="./assets/coracao.png" alt="robo_nav" class="d-inline-block align-text-top">
                <span id="coracao-count">0</span> <!-- Exibe a quantidade de corações -->
            </a>
        </div>

        <div class="coluna">
            <a class="navbar-brand imagem_nav" href="#">
                <img src="./assets/moeda.png" alt="robo_nav" class="d-inline-block align-text-top">
                <span id="moeda-count">0</span> <!-- Exibe a quantidade de moedas -->
            </a>
        </div>

        <div class="coluna">        
            <a class="navbar-brand imagem_nav" href="#">
                <img src="./assets/diamante.png" alt="robo_nav" class="d-inline-block align-text-top">
                <span id="diamante-count">0</span> <!-- Exibe a quantidade de diamantes -->
            </a>
        </div>
    </div>
</nav>

   <!-- final da nav -->


      <nav class="navbar bg-body-tertiary">
        <div class="container-fluid">
          <a class="navbar-brand" href="#"></a>
          <button class="navbar-toggler" type="button" data-bs-toggle="offcanvas" data-bs-target="#offcanvasNavbar" aria-controls="offcanvasNavbar" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasNavbar" aria-labelledby="offcanvasNavbarLabel">
            <div class="offcanvas-header">
              <h5 class="offcanvas-title fw-bold" id="offcanvasNavbarLabel">Menu</h5>
              <button type="button" class="btn-close" data-bs-dismiss="offcanvas" aria-label="Close"></button>
            </div>
            <div class="offcanvas-body">
              <ul class="navbar-nav justify-content-end flex-grow-1 pe-3">
                <li class="nav-item">
                  <a class="nav-link fs-2 fw-bold" href="Tela_Fase_Iniciante.html"><img src="assets/cerebro.png" alt=""> Módulo 1 - Lógica de Programação</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link fs-2 fw-bold" href="#"><img src="assets/logos_python.png" alt=""> Módulo 2 - Python</a>
                </li>
                <li class="nav-item">
                  <a class="nav-link fs-2 fw-bold" href="#"><img src="assets/logos_html-5.png" alt=""> Módulo 3 - HTML</a>
                </li>
  
              </ul>
              
              </form>
            </div>
          </div>
        </div>
      </nav>

    
 <!-- final da nav do botao -->
      
      <main class="pagina container">
      <div class="linhas my-5">
        <div class="row align-items-center linha1">
          <div class="col m-0 p-0">
            <img id="roboMain" src="assets/robo_tela_jogo.png" alt="">
          </div>

           <div class="col m-0 p-0">
            <a href="telaJogo.html"><img id="fase1" src="assets/fase1.png" alt=""></a>
          </div>

    
          <div class="col m-0 px-0">
            <a href="telaJogo2.html"><img id="fase2" src="assets/fase2.png" alt=""></a>
          </div>

        <div class="row align-items-center linha2">
          <div class="col">
            <a href="telaJogo3.html"><img id="fase3" src="assets/fase3.png" alt=""></a>
          </div>



          <div class="col m-0 py-5 ">
            <a href="telaJogo4.html"><img id="fase4" src="assets/fase4.png" alt=""></a>
          </div>


          <div class="col ps-3">
            <a href="telaJogo5.html"><img id="fase5" src="assets/fase5.png" alt=""></a>
          </div>

        
        </div>

        <div class="row align-items-center py-3 linha3">
          <div class="col ">
            <img src="assets/bonus.png" alt="">
          </div>



          <div class="col">
            <a href="telaJogo6.html"><img id="fase6" src="assets/fase6.png" alt=""></a>
          </div>


          <div class="col">
            <a href="telaJogo7.html"><img id="fase7" src="assets/fase7.png" alt=""></a>
          </div>

      </main>

  
      
    
      <footer class="fixed-bottom ">
      
        <div class="container my-4">
          <div class="row mx-auto ">
            <div class="col ">
              <a href="./menu.html"><img src="assets/folter_inicio.png" alt=""></a>
            </div>
            <div class="col ">
              <a href="./rank_de_Usuario.html"><img src="assets/folter_trof.png" alt=""></a>
            </div>
            <div class="col ">
              <a href="./TelaConfig.html"><img src="assets/conf.png" alt=""></a>
            </div>
            <div class="col ">
              <a href="./loja.html"><img src="assets/loja.png" alt=""></a>
            </div>
            <div class="col ">
              <a href="./index.html"><img src="assets/btn_sair.png" alt=""></a>
            </div>
          </div>
        </div>
    
    </footer>

    <!-- Vai servir para verificar se a pessoal tem uma sessão aberta de autentificação -->
    

    <script>

      const API_URL = 'http://127.0.0.1:5000'; // URL base da API, endereço da API
  
      // Verifica se o usuário está autenticado
      const usuarioSessao = sessionStorage.getItem('usuario');

      
      

      if (usuarioSessao) {
          
          const usuario = JSON.parse(usuarioSessao);
          
          
          // Função principal para executar as operações
          async function iniciar() {
              try {
                
                  // Realizar POST para criar trilha e progresso
                  const trilhaId = await criarTrilha(usuario.user_id); //O erro esta aqui
                  console.log("tentou fazer")
  
                  // Realizar GET para buscar dados de trilha e vincular aos recursos
                  const recursos = await buscarRecursos(trilhaId);
  
                  // Atualizar os elementos da página com os dados dos recursos
                  atualizarElementosHTML(recursos);
                  
              } catch (error) {
                  console.error('Erro ao inicializar:', error);
              }
          }
  
          iniciar(); // Inicia o processo após a verificação do usuário
      } else {
          // Redireciona para a página de login se o usuário não estiver autenticado
          window.location.href = 'index.html';
      }
  
      // Função para criar trilha e progresso (POST)


      //Corrigir o erro da passagem de ID
      async function criarTrilha(usuarioId) {
          try {
            console.log("entrou dentro da criarTrilha",usuarioId)
              const response = await fetch(`${API_URL}/trilhas`, {
                  method: 'POST',
                  headers: {
'Content-Type': 'application/json',
                  },
                  body: JSON.stringify({  user_id: usuarioId }),
              });

              
              
  
              if (!response.ok) throw new Error('Erro ao criar trilha');
              const data = await response.json();
              console.log('Trilha criada com sucesso:', data);
              console.log("chegamos ate aqui ")

              return data.id_progresso; // Retorna o ID da trilha
          } catch (error) {
              console.error('Erro no POST /trilhas:', error);
              throw error;
          }
      }
  
     





      
  
      // Função para atualizar os elementos HTML com os dados dos recursos
      function atualizarElementosHTML(recursos) {
          let coracoes = 0;
          let moedas = 0;
          let diamantes = 0;
  
          // Soma os valores dos recursos
          recursos.forEach(recurso => {
              if (recurso.tipo === 'coração') coracoes += recurso.quantidade;
              if (recurso.tipo === 'moeda') moedas += recurso.quantidade;
              if (recurso.tipo === 'diamante') diamantes += recurso.quantidade;
          });
  
          // Atualiza os elementos na página
          document.getElementById('coracao-count').innerText = coracoes;
          document.getElementById('moeda-count').innerText = moedas;
          document.getElementById('diamante-count').innerText = diamantes;
      }


  </script>
  

  
      <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" 
      integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>